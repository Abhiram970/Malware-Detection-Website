from django.shortcuts import redirect, render
from django.contrib import messages
import warnings
from django.http import HttpResponseRedirect
import pandas as pd
from datetime import datetime
import pickle
import numpy as np
from django.contrib.auth.decorators import login_required
from django.http import HttpResponse

warnings.filterwarnings("ignore")

def getPredictions(bot,bot2,bot3,bot4,bot5):
    with open('xgboost.pkl', 'rb') as f:
        model = pickle.load(f)
    
    l = model.predict([[bot, bot2, 0.0, bot3, 0.0, 0.0, 0.20883545798489989, bot4, bot5, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]])
    
    return l

def predict(request):
    if request.method == "POST":
        bot = request.POST['bot1']
        bot2 = request.POST['bot2']
        bot3 = request.POST['bot3']
        bot4 = request.POST['bot4']
        bot5 = request.POST['bot5']

        result = getPredictions(bot)
        print("Final trojan or not " + str(result[0]))
        messages.info(request, "Final trojan or not : " + str(result[0]) )
        return HttpResponseRedirect(request.path_info)
    else:
        return render(request,'pred.html')
        